<div class="card">
  <div class="card__rotator">
     <img class="card__front" src="https://assets.codepen.io/13471/charizard-gx.webp" alt="Charizard" />
    <div class="card__shine"></div>
    <div class="card__glare"></div>
  </div>
</div>

:root {
  --mx: 50%; /* 鼠标 X 位置百分比 (默认居中) */
  --my: 50%; /* 鼠标 Y 位置百分比 */
  --r: 0deg; /* 旋转角度 */
  --s: 1;    /* 缩放比例 */
}

body {
  background: #333;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  perspective: 1000px; /* 3D 视距，这很重要 */
}

/* 卡片容器 */
.card {
  width: 300px; /* 卡片宽度 */
  aspect-ratio: 2.5 / 3.5; /* 宝可梦卡片比例 */
  position: relative;
  z-index: 1;
}

/* 旋转器：负责 3D 翻转 */
.card__rotator {
  width: 100%;
  height: 100%;
  border-radius: 15px;
  position: relative;
  transition: all 0.2s ease-out; /* 平滑过渡 */
  /* 核心：根据 JS 传入的变量进行旋转 */
  transform: rotateY(var(--r-x)) rotateX(var(--r-y));
  transform-style: preserve-3d;
  box-shadow: 0 20px 30px rgba(0,0,0,0.5);
}

/* 卡片图片 */
.card__front {
  width: 100%;
  height: 100%;
  border-radius: 15px;
  object-fit: cover;
}

/* --- 全息闪光层 (Shine) --- */
.card__shine, .card__glare {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 15px;
  mix-blend-mode: color-dodge; /* 混合模式：让亮部更亮，暗部透明 */
  pointer-events: none; /* 鼠标穿透 */
}

/* 这是一个简单的线性渐变模拟反光，原项目使用了复杂的贴图 */
.card__shine {
  background:
    linear-gradient(
      115deg,
      transparent 20%,
      rgba(255,255,255,0.4) 40%,
      rgba(255,0,255,0.4) 60%,
      transparent 80%
    );
  background-position: var(--mx) var(--my); /* 背景随鼠标移动 */
  background-size: 300% 300%;
  opacity: 0; /* 默认隐藏 */
  transition: opacity 0.5s;
}

/* --- 强光层 (Glare) --- */
.card__glare {
  background: radial-gradient(
    farthest-corner circle at var(--mx) var(--my),
    rgba(255,255,255,0.6) 0%,
    rgba(255,255,255,0) 80%
  );
  opacity: 0;
  mix-blend-mode: overlay;
}

/* 鼠标悬停时的状态 */
.card:hover .card__shine,
.card:hover .card__glare {
  opacity: 1;
}

const card = document.querySelector('.card');
const rotator = document.querySelector('.card__rotator');

card.addEventListener('mousemove', (e) => {
  const rect = card.getBoundingClientRect();
  const x = e.clientX - rect.left; // 鼠标在卡片内的 X 坐标
  const y = e.clientY - rect.top;  // 鼠标在卡片内的 Y 坐标

  // 计算百分比 (0% 到 100%) - 用于移动光泽背景
  const percentX = (x / rect.width) * 100;
  const percentY = (y / rect.height) * 100;

  // 计算旋转角度 (例如 -15deg 到 15deg)
  // 当鼠标在左边，Y轴旋转为负；在右边，Y轴旋转为正
  const rotateY = ((x / rect.width) - 0.5) * 30; // 30 是旋转幅度系数
  const rotateX = ((y / rect.height) - 0.5) * -30; // -30 是为了反向，鼠标在下时卡片要在X轴向下转

  // 将值赋给 CSS 变量
  rotator.style.setProperty('--mx', `${percentX}%`);
  rotator.style.setProperty('--my', `${percentY}%`);
  rotator.style.setProperty('--r-x', `${rotateY}deg`);
  rotator.style.setProperty('--r-y', `${rotateX}deg`);
});

// 鼠标离开时复位
card.addEventListener('mouseleave', () => {
  rotator.style.setProperty('--mx', `50%`);
  rotator.style.setProperty('--my', `50%`);
  rotator.style.setProperty('--r-x', `0deg`);
  rotator.style.setProperty('--r-y', `0deg`);
});
